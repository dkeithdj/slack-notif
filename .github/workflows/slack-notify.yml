name: Build and Push Outputs to Demo Repo

on:
  push:
    branches:
      - main
      - develop

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout current repository
        uses: actions/checkout@v4

      - name: Post a message in a channel
        id: deployment_message
        uses: slackapi/slack-github-action@v2.0.0
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_TOKEN }}
          payload: |
            channel: C082SRACXL5
            text: "Deployment started :eyes:"
            attachments:
              - color: "#dbab09"
                fields:
                  - title: "Status"
                    short: true
                    value: In Progress
      # Install dependencies (Modify this to your project)
      - name: Simulate process
        run: |
          sleep 10
          exit 0

      - name: Success message
        if: ${{ success() }}
        uses: slackapi/slack-github-action@v2.0.0
        with:
          method: chat.update
          token: ${{ secrets.SLACK_TOKEN }}
          payload: |
            channel: C082SRACXL5
            ts: "${{ steps.deployment_message.outputs.ts }}"
            text: "Deployment finished! :rocket:"
            attachments:
              [
                  {
                      "mrkdwn_in": ["text"],
                      "color": "#36a64f",
                      "author_name": "${{ github.actor }}",
                      "author_icon": "https://avatars.githubusercontent.com/${{github.actor}}",
                      "title": "PR#${{ github.event }} ${{ github.event.head_commit.message }}",
                      "title_link": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                      "text": "Action: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|${{github.run_id}}>",
                      "fields":
                      [
                          {
                              "title": "A field's title",
                              "value": "This field's value",
                              "short": false
                          },
                          {
                              "title": "A short field's title",
                              "value": "A short field's value",
                              "short": true
                          },
                          {
                              "title": "A second short field's title",
                              "value": "A second short field's value",
                              "short": true
                          }
                      ],
                      "thumb_url": "http://placekitten.com/g/200/200",
                      "footer": "footer",
                      "footer_icon": "https://platform.slack-edge.com/img/default_application_icon.png",
                      "ts": 123456789,
                      "accessory": {
                              "type": "button",
                              "text": {
                                "type": "plain_text",
                                "text": "Click Me",
                                "emoji": true
                              },
                              "value": "click_me_123",
                              "url": "https://google.com",
                              "action_id": "button-action"
                            }
                  }
              ]
      - name: fail message
        if: ${{ failure() }}
        uses: slackapi/slack-github-action@v2.0.0
        with:
          method: chat.update
          token: ${{ secrets.SLACK_TOKEN }}
          payload: |
            channel: C082SRACXL5
            ts: "${{ steps.deployment_message.outputs.ts }}"
            text: "Deployment failed! :red_circle:"
            attachments:
              - color: "#f44336"
                fields:
                  - title: "Status"
                    short: true
                    value: "Failed"

      # - name: after fail message
      #   if: ${{ failure() }}
      #   uses: slackapi/slack-github-action@v2.0.0
      #   with:
      #     method: chat.postMessage
      #     token: ${{ secrets.SLACK_TOKEN }}
      #     payload: |
      #       channel: C082SRACXL5
      #       thread_ts: "${{ steps.deployment_message.outputs.ts }}"
      #       text: "will not proceed to another build on ${{ github.sha }} and ${{ github.ref }}"
